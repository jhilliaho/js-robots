<!DOCTYPE html>
<html>
  <head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
	<script src="http://46.101.79.118:3000/static/javascripts/socket.io-1.4.5.js"></script>
  </head>
  <body>
  	<p>Temperature:</p>
	<div class="graph" id="temperatureGraph" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
  	<p>Humidity:</p>
	<div class="graph" id="humidityGraph" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
  	<p>Pir:</p>
	<div class="graph" id="pirGraph" style="min-width: 310px; height: 400px; margin: 0 auto"></div>
  </body>
</html>


<script>

$('.graph').highcharts({
    title: {
        text: '',
        x: -20 //center
    },
    xAxis: {
        type: 'datetime'
    },
    chart: {
        type: 'spline',
  		zoomType: 'x',
        panning: true,
        panKey: 'shift'
   	},
    legend: {
        layout: 'vertical',
        align: 'right',
        verticalAlign: 'middle',
        borderWidth: 0
    },
    series: [{
        name: 'data',
        data: []
    }],

});

var timeZoneOffset = new Date().getTimezoneOffset();
timeZoneOffset *= 60000;

var socket = io('http://46.101.79.118:3000');
socket.emit('getData');

$('.graph').highcharts().showLoading("Wait a second");

socket.on('allData', function (data) {

	for (var i = 0; i < data.length; ++i) {
		var date = new Date(data[i].date).getTime() - timeZoneOffset;
		var humidity = data[i].humidity;
		var temperature = data[i].temperature;
		var pir = data[i].pir;
		console.log(date, humidity, temperature, pir);

		$('#temperatureGraph').highcharts().xAxis[0].series[0].addPoint([date,temperature], false);
		$('#humidityGraph').highcharts().xAxis[0].series[0].addPoint([date,humidity], false);
		$('#pirGraph').highcharts().xAxis[0].series[0].addPoint([date,pir], false);
	}

	$('.graph').highcharts().redraw();
	$('.graph').highcharts().hideLoading();
});

socket.on('newData', function (data) {
	var date = new Date(data.date).getTime() - timeZoneOffset;
	var humidity = data.humidity;
	var temperature = data.temperature;
	var pir = data[i].pir;
	console.log(date, humidity, temperature, pir);
	$('#temperatureGraph').highcharts().xAxis[0].series[0].addPoint([date,temperature], true);
	$('#humidityGraph').highcharts().xAxis[0].series[0].addPoint([date,humidity], true);
	$('#pirGraph').highcharts().xAxis[0].series[0].addPoint([date,pir], true);

});
</script>

